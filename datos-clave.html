<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Datos clave de aeropuertos ‚Äì GeoData ORSNA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS para los mapas -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    /* ==============================
       RESETEO B√ÅSICO
       ============================== */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.5;
    }

    a { color: #0072bb; text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ==============================
       TOPBAR
       ============================== */
    .topbar {
      background-color: #002855;
      color: #fff;
      font-size: 0.85rem;
      padding: 4px 16px;
    }
    .topbar-inner {
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* ==============================
       HEADER ORSNA
       ============================== */
    .gov-header {
      background-color: #ffffff;
      border-bottom: 1px solid #dde2e6;
    }
    .gov-header-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 24px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #00a3e0, #0072bb);
    }

    .brand-text { display: flex; flex-direction: column; }
    .brand-text span:first-child {
      font-size: 0.78rem;
      text-transform: uppercase;
      color: #6c757d;
    }
    .brand-text span:last-child {
      font-size: 1.1rem;
      font-weight: 600;
      color: #002855;
    }

    /* ==============================
       BREADCRUMB
       ============================== */
    .breadcrumb {
      background-color: #EEF2F7;
      border-bottom: 1px solid #dde2e6;
      font-size: 0.85rem;
    }
    .breadcrumb-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 8px 16px;
      color: #6c757d;
    }

    /* ==============================
       MAIN LAYOUT
       ============================== */
    main {
      max-width: 1120px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header.page-header {
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      align-items: flex-start;
    }

    .page-header-left h1 {
      font-size: 1.8rem;
      font-weight: 600;
      color: #002855;
    }
    .page-header-left p {
      margin-top: 4px;
      color: #555;
      font-size: 0.95rem;
    }

    .selector {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 0.9rem;
    }
    .selector label { color: #444; }
    .selector select {
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid #c0c7d4;
      font-size: 0.9rem;
      min-width: 220px;
    }

    /* ==============================
       BANDA KPI SUPERIOR
       ============================== */
    .kpi-strip {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 8px;
      margin: 10px 0 18px;
    }
    .kpi-card {
      background: #ffffff;
      border-radius: 4px;
      border: 1px solid #d0d7e2;
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      font-size: 0.8rem;
      text-align: center;
    }
    .kpi-card img {
      width: 52px;
      height: 52px;
      object-fit: contain;
      margin-bottom: 2px;
    }
    .kpi-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: #2a5fa0;
      line-height: 1.1;
    }
    .kpi-label {
      color: #555;
      font-size: 0.78rem;
    }

    /* ==============================
       GRID PRINCIPAL DE FICHAS
       ============================== */
    .grid {
      display: grid;
      grid-template-columns: 2fr 2fr 2fr;
      grid-template-areas:
        "superficie terminal ubicacion"
        "movimiento terminal concesion"
        "empleo servicios servicios";
      gap: 12px;
      margin-top: 8px;
    }

    .panel {
      background: #fff;
      border-radius: 4px;
      border: 1px solid #d0d7e2;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      background: #306fb0;
      color: #fff;
      padding: 6px 10px;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .panel-body {
      padding: 8px 10px 10px;
      font-size: 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
      font-size: 0.9rem;
    }
    .metric-row .value {
      font-size: 1.3rem;
      font-weight: 700;
      color: #2a5fa0;
    }

    .small-label {
      font-size: 0.8rem;
      color: #777;
    }

    ul {
      padding-left: 18px;
      font-size: 0.88rem;
    }

    .subpanel-title {
      margin-top: 4px;
      font-weight: 600;
      color: #2a5fa0;
      font-size: 0.9rem;
    }

    /* ==============================
       PANEL SUPERFICIE:
       - 2 KPIs tipo tarjeta
       - 1 con mapa de predio
       - 1 con imagen de terminal
       ============================== */
    .panel-superficie {
      grid-area: superficie;
    }

    .panel-superficie .panel-body {
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .superficie-kpi {
      display: flex;
      flex-direction: column;
      gap: 6px;
      background: #ffffff;
      border: 1px solid #d0d7e2;
      border-radius: 4px;
      padding: 6px 8px;
    }

    .superficie-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
    }

    .superficie-label {
      font-size: 0.9rem;
      color: #444;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .superficie-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: #004b80;
      white-space: nowrap;
    }

    .superficie-unit {
      font-size: 0.85rem;
      font-weight: 600;
      color: #004b80;
      margin-left: 3px;
    }

    .superficie-thumb {
      width: 100%;
      height: 230px;  /* alto mapa/imagen */
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #ffffff;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Mapa Leaflet del predio */
    .map-predio {
      width: 100%;
      height: 100%;
    }

    /* Imagen de terminal dentro de la caja */
    .superficie-thumb img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* ==============================
       PANEL √ÅREA DE MOVIMIENTO
       - estilo tipo KPI
       - pistas + PSN
       - mapa de PSN satelital
       ============================== */
    .panel-movimiento {
      grid-area: movimiento;
    }

    .kpi-icon {
      width: 40px;
      height: 40px;
      object-fit: contain;
      vertical-align: middle;
    }

    .mov-runway-list {
      margin-top: 6px;
      font-size: 0.82rem;
      color: #555;
    }

    .mov-runway-row {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      padding: 2px 0;
    }

    .mov-runway-orient {
      font-weight: 600;
      color: #004b80;
      white-space: nowrap;
    }

.mov-runway-orient {
  font-weight: 700;
  color: #004b80;
  white-space: nowrap;
  font-size: 0.95rem;  /* m√°s grande que antes */
}

.mov-runway-info {
  flex: 1;
  text-align: right;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 4px;
}

/* Cajita gris para la medida tipo "2.804 x 45" */
.runway-chip {
  display: inline-block;
  padding: 4px 12px;
  background: #b3b3b3;
  color: #ffffff;
  border-radius: 3px;
  font-weight: 600;
  font-size: 0.85rem;
}

/* Material de la pista (asfalto, hormig√≥n, etc.) */
.mov-runway-mat {
  font-size: 0.8rem;
  color: #666;
}


    .mov-psn-list {
      margin-top: 6px;
    }

    .mov-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: #444;
    }

    .mov-badge {
      background: #6b2f82;   /* Pod√©s cambiar a #306fb0 si quer√©s azul */
      color: #fff;
      font-weight: 700;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.95rem;
    }

    .map-psn {
      width: 100%;
      height: 220px;   /* alto del mapa de PSN */
    }

    .psn-tooltip {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #333;
      border-radius: 2px;
      padding: 2px 2px;
      font-size: 0.5rem;
      color: #111;
    }

    /* ==============================
       PANEL TERMINAL (recorrido del pasajero)
       ============================== */
    .panel-terminal { grid-area: terminal; }

    .terminal-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .terminal-step-title {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      color: #2a5fa0;
      margin-top: 4px;
    }

    .terminal-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      border-bottom: 1px dashed #d0d7e2;
    }

    .terminal-item:last-child {
      border-bottom: none;
    }

    .terminal-icon img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    /* Iconos m√°s grandes SOLO en √Årea de movimiento (Pistas + PSN) */
    .panel-movimiento .terminal-icon img {
      width: 48px;
      height: 48px;
    }

    .terminal-text {
      flex: 1;
    }

    .terminal-title {
      font-size: 0.9rem;
      color: #444;
    }

    .terminal-sub {
      font-size: 0.78rem;
      color: #777;
    }

    /* Reducir tama√±o del nombre del aeropuerto dentro de los encabezados */
.panel-header small {
  font-size: 0.7rem;     /* m√°s chico que el t√≠tulo principal */
  font-weight: 300;      /* m√°s liviano */
  opacity: 0.85;         /* menos contraste */
  margin-left: 4px;      /* un poquito de aire */
}

    
    .terminal-badge {
      min-width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #6b2f82;
      color: #fff;
      font-weight: 700;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .terminal-separator {
      border-top: 1px solid #e0e7f0;
      margin: 4px 0;
    }

/* ==============================
   PANEL UBICACI√ìN Y ACCESIBILIDAD
   ============================== */
.panel-ubicacion { grid-area: ubicacion; }

.ubicacion-kpi {
  background: #ffffff;
  border: 1px solid #d0d7e2;
  border-radius: 4px;
  padding: 6px 8px;
  margin-bottom: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.ubi-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}

.ubi-label {
  font-size: 0.85rem;
  color: #444;
}

.ubi-chip {
  font-size: 0.9rem;
  font-weight: 700;
  color: #004b80;      /* azul, igual que orientaci√≥n de pista */
  white-space: normal;
  text-align: right;
}


/* Contenedor del mapa de ubicaci√≥n */
.ubicacion-map-wrapper {
  margin-top: 6px;
}

.map-ubicacion {
  width: 100%;
  height: 420px !important;  /* prob√° 300‚Äì340 seg√∫n el espacio que veas */
  border-radius: 4px;
  border: 1px solid #d0d7e2;
  overflow: hidden;
}


    /* ==============================
       PANELES CONCESI√ìN / EMPLEO / SERVICIOS
       ============================== */
    .panel-concesion { grid-area: concesion; }
    .panel-empleo { grid-area: empleo; }
    .panel-servicios { grid-area: servicios; }

    /* ==============================
       FOOTER
       ============================== */
    footer {
      border-top: 1px solid #dde2e6;
      background-color: #ffffff;
      margin-top: 24px;
      font-size: 0.83rem;
      color: #555;
    }
    .footer-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 12px 16px;
      text-align: right;
    }

    /* ==============================
       RESPONSIVE
       ============================== */
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
        grid-template-areas:
          "superficie"
          "movimiento"
          "terminal"
          "ubicacion"
          "concesion"
          "empleo"
          "servicios";
      }
      header.page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .selector { align-items: flex-start; }
      .kpi-strip {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>

<body>
  <!-- ==========================
       TOPBAR
       ========================== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div>Presidencia de la Naci√≥n</div>
      <div><a href="index.html" style="color:#fff;text-decoration:none;">GeoData</a></div>
    </div>
  </div>

  <!-- ==========================
       HEADER ORSNA
       ========================== -->
  <div class="gov-header">
    <div class="gov-header-inner">
      <div class="brand">
        <div class="brand-logo"></div>
        <div class="brand-text">
          <span>Organismo Regulador del Sistema Nacional de Aeropuertos</span>
          <span>ORSNA</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ==========================
       BREADCRUMB
       ========================== -->
  <nav class="breadcrumb">
    <div class="breadcrumb-inner">
      <a href="index.html">Inicio</a> ‚Ä∫ Datos clave por aeropuerto
    </div>
  </nav>

  <!-- ==========================
       CONTENIDO PRINCIPAL
       ========================== -->
  <main>
    <!-- Encabezado + selector de aeropuerto -->
    <header class="page-header">
      <div class="page-header-left">
        <h1 id="pageTitle">Datos clave por aeropuerto</h1>
        <p id="pageSubtitle">
          Sistema Nacional de Aeropuertos ¬∑ Datos Clave 2025
        </p>
      </div>

      <div class="selector">
        <label for="airportSelect">Seleccionar aeropuerto</label>
        <select id="airportSelect">
          <option value="">Cargando aeropuertos...</option>
        </select>
      </div>
    </header>

    <!-- BANDA KPI SUPERIOR -->
    <section class="kpi-strip">
      <div class="kpi-card">
        <img src="img/icons/checkin.png" alt="Check-in">
        <div class="kpi-value" id="kpiCheckin">‚Äì</div>
        <div class="kpi-label">Mostradores</div>
      </div>
      <div class="kpi-card">
        <img src="img/icons/boarding.png" alt="Puertas de embarque">
        <div class="kpi-value" id="kpiPuertas">‚Äì</div>
        <div class="kpi-label">Puertas embarque</div>
      </div>
      <div class="kpi-card">
        <img src="img/icons/baggage.png" alt="Cintas de equipaje">
        <div class="kpi-value" id="kpiCintas">‚Äì</div>
        <div class="kpi-label">Cintas equipaje</div>
      </div>
      <div class="kpi-card">
        <img src="img/icons/PSN.png" alt="PSN">
        <div class="kpi-value" id="kpiPSN">‚Äì</div>
        <div class="kpi-label">PSN totales</div>
      </div>
      <div class="kpi-card">
        <img src="img/icons/estacionamiento.png" alt="Estacionamiento">
        <div class="kpi-value" id="kpiEstac">‚Äì</div>
        <div class="kpi-label">Estacionamiento</div>
      </div>
      <div class="kpi-card">
        <img src="img/icons/manga.png" alt="Mangas">
        <div class="kpi-value" id="kpiMangas">‚Äì</div>
        <div class="kpi-label">Mangas</div>
      </div>
      <div class="kpi-card">
        <img src="img/icons/PSA.png" alt="PSA">
        <div class="kpi-value" id="kpiPSA">‚Äì</div>
        <div class="kpi-label">Puestos PSA</div>
      </div>
    </section>

    <!-- GRID PRINCIPAL -->
    <section class="grid">

      <!-- PANEL 1: SUPERFICIE -->
      <section class="panel panel-superficie">
        <div class="panel-header" id="hdrSuperficie">Superficie</div>
        <div class="panel-body">

          <!-- KPI: Tama√±o del predio con mapa Leaflet -->
          <div class="superficie-kpi">
            <div class="superficie-header-row">
              <div class="superficie-label">
                <span>Tama√±o del predio</span>
              </div>
              <div class="superficie-value">
                <span id="supPredio"></span>
                <span class="superficie-unit">hect√°reas</span>
              </div>
            </div>

            <div class="superficie-thumb">
              <div id="mapPredio" class="map-predio"></div>
            </div>
          </div>

          <!-- KPI: Terminal de pasajeros con imagen -->
          <div class="superficie-kpi">
            <div class="superficie-header-row">
              <div class="superficie-label">
                <span>Terminal de pasajeros</span>
              </div>
              <div class="superficie-value">
                <span id="terminalM2"></span>
                <span class="superficie-unit">m¬≤</span>
              </div>
            </div>

            <div class="superficie-thumb">
              <img id="imgTerminal" alt="Imagen de la terminal del aeropuerto">
            </div>
          </div>

        </div>
      </section>

      <!-- PANEL 2: √ÅREA DE MOVIMIENTO -->
      <section class="panel panel-movimiento">
      <div class="panel-header" id="hdrMovimiento">√Årea de movimiento</div>
        <div class="panel-body">

          <!-- KPI Pistas (estilo Terminal) -->
          <div class="superficie-kpi" style="padding:10px 8px;">
            <div class="terminal-item" style="border-bottom:none;">
              <div class="terminal-icon">
                <img src="img/icons/runway.png" alt="">
              </div>
              <div class="terminal-text">
                <div class="terminal-title">Pistas de aterrizaje</div>
                <!-- Subt√≠tulo din√°mico (se completa desde JS) -->
                <div class="terminal-sub" id="pistasSubtitulo">
                  Orientaciones y dimensiones
                </div>
              </div>
              <!-- Burbuja con la cantidad de pistas -->
              <div class="terminal-badge" id="badgeCantPistas">‚Äì</div>
            </div>

            <!-- Lista de pistas -->
            <div class="mov-runway-list" id="pistasDetalle" style="margin-top:8px;">
              <!-- Se completa desde JS -->
            </div>
          </div>

          <!-- KPI Posiciones en plataforma (estilo Terminal) -->
          <div class="superficie-kpi" style="padding:10px 8px;">

            <div class="terminal-item" style="border-bottom:none;">
              <div class="terminal-icon">
                <img src="img/icons/PSN.png" alt="" style="width:55px;">  <!-- aumentamos solo el tama√±o del icono en el area de movimiento -->
              </div>
              <div class="terminal-text">
                <div class="terminal-title">Posiciones en plataforma</div>
                <div class="terminal-sub">
                  √Årea destinada al estacionamiento de las aeronaves
                </div>
              </div>
              <!-- Burbuja con el TOTAL de PSN -->
              <div class="terminal-badge" id="badgePsnTotal">‚Äì</div>
            </div>
            
            <!-- PSN comerciales / aviaci√≥n general -->
            <div class="mov-psn-list" style="margin-top:2px;">
              <div class="mov-item">
                <span>Posiciones aeronaves comerciales</span>
                <span class="mov-badge" id="psnCom">‚Äì</span>
              </div>
              <div class="mov-item">
                <span>Posiciones aviaci√≥n general</span>
                <span class="mov-badge" id="psnGen">‚Äì</span>
              </div>
            </div>

            <!-- Mapa Leaflet de PSN sobre sat√©lite -->
            <div class="superficie-thumb" style="margin-top:6px;">
              <div id="mapPSN" class="map-psn"></div>
            </div>
          </div>

        </div>
      </section>

      <!-- PANEL 3: TERMINAL DE PASAJEROS (recorrido) -->
      <section class="panel panel-terminal">
      <div class="panel-header" id="hdrTerminal">Terminal de pasajeros</div>
        <div class="panel-body terminal-body">

          <!-- Llegada / Check-in -->
          <div class="terminal-step-title">Llegada y check-in</div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/checkin.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Mostradores de check-in</div>
              <div class="terminal-sub">Puestos habilitados para atenci√≥n presencial</div>
            </div>
            <div class="terminal-badge" id="mostradoresCheckin">‚Äì</div>
          </div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/kiosko.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Kioscos self check-in</div>
              <div class="terminal-sub">Equipos de autoatenci√≥n</div>
            </div>
            <div class="terminal-badge" id="kioscosSelf">‚Äì</div>
          </div>

          <div class="terminal-separator"></div>

          <!-- Control de seguridad -->
          <div class="terminal-step-title">Control de seguridad</div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/PSA.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Puestos PSA</div>
              <div class="terminal-sub">Puestos de control de seguridad</div>
            </div>
            <div class="terminal-badge" id="psaBadgeProxy">‚Äì</div>
          </div>

          <div class="terminal-separator"></div>

          <!-- Embarque -->
          <div class="terminal-step-title">Embarque</div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/boarding.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Puertas de embarque</div>
              <div class="terminal-sub" id="puertasDetalle">‚Äì</div>
            </div>
            <div class="terminal-badge" id="puertasTotal">‚Äì</div>
          </div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/manga.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Mangas telesc√≥picas</div>
              <div class="terminal-sub">Conexi√≥n directa aeronave‚Äìterminal</div>
            </div>
            <div class="terminal-badge" id="mangas">‚Äì</div>
          </div>

          <div class="terminal-separator"></div>

          <!-- Arribo / equipaje -->
          <div class="terminal-step-title">Arribo y equipaje</div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/baggage.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Cintas de equipaje</div>
              <div class="terminal-sub" id="cintasDetalle">‚Äì</div>
            </div>
            <div class="terminal-badge" id="cintasTotal">‚Äì</div>
          </div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/Carrito.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Carritos porta equipajes</div>
              <div class="terminal-sub">Disponibles para el pasajero</div>
            </div>
            <div class="terminal-badge" id="carritos">‚Äì</div>
          </div>

          <div class="terminal-separator"></div>

          <!-- Apoyo al pasajero -->
          <div class="terminal-step-title">Apoyo al pasajero</div>

          <div class="terminal-item">
            <div class="terminal-icon">
              <img src="img/icons/estacionamiento.png" alt="">
            </div>
            <div class="terminal-text">
              <div class="terminal-title">Plazas de estacionamiento vehicular</div>
              <div class="terminal-sub">Capacidad total de estacionamiento</div>
            </div>
            <div class="terminal-badge" id="estacionamiento">‚Äì</div>
          </div>

          <!-- elemento oculto para no romper l√≥gica previa de terminalM2Dup -->
          <span id="terminalM2Dup" style="display:none;"></span>

        </div>
      </section>

      <!-- PANEL 4: UBICACI√ìN Y ACCESIBILIDAD (solo texto) -->
<section class="panel panel-ubicacion">
  <div class="panel-header" id="hdrUbicacion">Ubicaci√≥n y accesibilidad</div>
  <div class="panel-body">

    <!-- KPI tipo fila (similar a Pistas) -->
    <div class="ubicacion-kpi">
      <div class="ubi-row">
        <span class="ubi-label">Ubicaci√≥n</span>
        <span class="ubi-chip" id="ubicacionText">‚Äì</span>
      </div>

      <div class="ubi-row">
        <span class="ubi-label">Distancia al centro de la ciudad</span>
        <span class="ubi-chip" id="distanciaCentro">‚Äì</span>
      </div>

      <div class="ubi-row">
        <span class="ubi-label">Horario de operaci√≥n</span>
        <span class="ubi-chip" id="horarioOperacion">‚Äì</span>
      </div>
    </div>

    <!-- Mapa de ubicaci√≥n nacional -->
    <div class="ubicacion-map-wrapper">
      <div id="mapUbicacion" class="map-ubicacion" style="height:420px;"></div>
    </div>

  </div>
</section>


      <!-- PANEL 5: CONCESI√ìN Y EXPLOTACI√ìN -->
      <section class="panel panel-concesion">
      <div class="panel-header" id="hdrConcesion">Concesi√≥n y explotaci√≥n</div>
        <div class="panel-body">
          <div class="metric-row">
            <span>Superficie concesionada</span>
            <span class="value" id="supConcesionadaHa">‚Äì</span>
          </div>
          <div class="small-label">hect√°reas</div>

          <div class="small-label" style="margin-top:6px;">√Åreas concesionadas</div>
          <div class="small-label" id="areasConcesionadas">‚Äì</div>

          <div class="small-label" style="margin-top:10px;">Explotador</div>
          <div class="small-label" id="explotador">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Grupo de concesi√≥n</div>
          <div class="small-label" id="grupo">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Concesi√≥n hasta</div>
          <div class="small-label" id="concesionHasta">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">C√≥digos</div>
          <div class="small-label" id="codigos">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Habilitaci√≥n</div>
          <div class="small-label" id="habilitacion">‚Äì</div>
        </div>
      </section>

      <!-- PANEL 6: EMPLEO Y POBLACI√ìN -->
      <section class="panel panel-empleo">
      <div class="panel-header" id="hdrEmpleo">Empleo y √°rea de influencia</div>
        <div class="panel-body">
          <div class="small-label">Empleo directo 2024</div>
          <div class="metric-row">
            <span>Personas empleadas</span>
            <span class="value" id="empleoDirecto">‚Äì</span>
          </div>

          <div class="small-label" style="margin-top:6px;">Poblaci√≥n del √°rea de influencia (Censo 2022)</div>
          <div class="metric-row">
            <span>Poblaci√≥n estimada</span>
            <span class="value" id="poblacionInfluencia">‚Äì</span>
          </div>
        </div>
      </section>

      <!-- PANEL 7: SERVICIOS Y AYUDAS -->
      <section class="panel panel-servicios">
      <div class="panel-header" id="hdrServicios">Servicios y ayudas</div>
        <div class="panel-body">
          <div class="small-label">Ayudas radioel√©ctricas</div>
          <div class="small-label" id="radioayudas">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Ayudas visuales</div>
          <div class="small-label" id="ayudasVisuales">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">AWOS</div>
          <div class="small-label" id="awos">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Operador de cargas</div>
          <div class="small-label" id="operadorCargas">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Terminal de cargas (m¬≤)</div>
          <div class="small-label" id="terminalCargasM2">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Aeroplantas</div>
          <div class="small-label" id="aeroplantas">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Clave de referencia de aer√≥dromo</div>
          <div class="small-label" id="claveRef">‚Äì</div>

          <div class="small-label" style="margin-top:6px;">Categor√≠a SEI normal</div>
          <div class="small-label" id="categoriaSEI">‚Äì</div>
        </div>
      </section>

    </section>
  </main>

  <!-- ==========================
       FOOTER
       ========================== -->
  <footer>
    <div class="footer-inner" id="footerNote">
      Fuente: ORSNA ‚Äì Datos de la planilla b√°sica por aeropuerto.
    </div>
  </footer>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>

  <!-- Esri Leaflet (para mapa satelital) -->
  <script src="https://unpkg.com/esri-leaflet@3/dist/esri-leaflet.js" crossorigin=""></script>

  <script>
    /* ============================================
       VARIABLES GLOBALES
       ============================================ */
    let aeropuertos = [];
    let poligonos = [];       // Predios (pol√≠gonos)
    let psnFeatures = [];     // Posiciones de estacionamiento (puntos)
    let pistasFeatures = [];  // NUEVO: Pistas (MultiPolygon)

    const selectEl = document.getElementById("airportSelect");

let map, mapMarker, poligonoLayer;           // Mapa predio
let mapPSN, psnLayer, pistasLayerPSN;        // Mapa PSN + pistas
let mapUbicacion, ubicacionMarker, provinciasLayer; // Mapa nacional

let provinciasFeatures = [];                 // GeoJSON de provincias (opcional)

    // Icono para el aeropuerto seleccionado en el mapa nacional
const airportIcon = L.icon({
  iconUrl: "img/icons/AeropuertosSNA.png",
  iconSize:     [32, 32],  // ajust√° si lo ves muy grande/chico
  iconAnchor:   [16, 16],  // centro del √≠cono
  tooltipAnchor:[0, -18]   // d√≥nde aparece la etiqueta IATA respecto del √≠cono
});


    /* ============================================
       HELPERS DE FORMATEO
       ============================================ */
    function formatNumber(n) {
      if (n === null || n === undefined || n === "" || isNaN(n)) return "‚Äì";
      return Number(n).toLocaleString("es-AR");
    }

    function clean(text) {
      if (text === null || text === undefined) return "";
      return String(text).trim();
    }

    function safeVal(v) {
      return (v !== null && v !== undefined && v !== "" && !isNaN(v))
        ? formatNumber(v)
        : (clean(v) || "‚Äì");
    }

    // Para descomponer campos con m√∫ltiples valores (pistas)
    function splitField(str) {
      if (!str) return [];
      return str
        .split(/[\n;]+| {2,}|\t+/)
        .map(s => s.trim())
        .filter(Boolean);
    }
// Devuelve [lat, lon] del centro del aeropuerto
// usando primero el pol√≠gono de predio y, si no hay, lat/lon del registro
function getAirportCenterLatLng(a) {
  const iata = a.IATA;

  // 1) Intentar con pol√≠gono de predio
  if (poligonos.length && iata) {
    const feats = poligonos.filter(f => {
      const props = f.properties || {};
      const code = props.IATA || props.iata || props.iata_code;
      return String(code).toUpperCase() === String(iata).toUpperCase();
    });

    if (feats.length) {
      // No hace falta agregarlo al mapa, solo usamos bounds
      const tempLayer = L.geoJSON(feats);
      const bounds = tempLayer.getBounds();
      if (bounds.isValid()) {
        const center = bounds.getCenter();
        return [center.lat, center.lng];
      }
    }
  }

  // 2) Fallback: campos Lat / Lon del GeoJSON de aeropuertos, si existen
  let lat = a["Lat"] || a["LAT"];
  let lon = a["Lon"] || a["LON"] || a["Long"];

  if (lat && lon && !isNaN(Number(lat)) && !isNaN(Number(lon))) {
    return [Number(lat), Number(lon)];
  }

  // 3) Si no hay nada, devolvemos null
  return null;
}

    /* ============================================
       INICIALIZACI√ìN DE MAPAS LEAFLET
       ============================================ */
    function initMap() {
      // 1) Mapa de predio (OpenStreetMap)
      map = L.map("mapPredio").setView([-34.6, -58.4], 5);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);

      mapMarker = L.marker([-34.6, -58.4]).addTo(map);

      // 2) Mapa de PSN (Esri Imagery v√≠a Esri Leaflet)
      mapPSN = L.map("mapPSN").setView([-34.6, -58.4], 5);
      L.esri.basemapLayer("Imagery").addTo(mapPSN);

      // 3) Mapa de ubicaci√≥n nacional (OSM)
      const mapUbDiv = document.getElementById("mapUbicacion");
      if (mapUbDiv) {
        mapUbDiv.style.height = "420px";  // FORZAMOS la altura desde JS
      }

      mapUbicacion = L.map("mapUbicacion", {
      zoomControl: false
      }).setView([-38, -64], 4);

L.tileLayer(
  "https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG:3857@png/{z}/{x}/{-y}.png",
  {
    maxZoom: 14,
    tms: true,
    attribution: "¬© IGN Argentina - Argenmap"
  }
).addTo(mapUbicacion);

}

    /* ============================================
       MAPA DE PREDIO (pol√≠gono o punto)
       ============================================ */
    function updateMapForAirport(a) {
      if (!map) return;

      // Limpiar pol√≠gono previo
      if (poligonoLayer) {
        map.removeLayer(poligonoLayer);
        poligonoLayer = null;
      }

      const iata = a.IATA;

      // 1) Intentar centrar por pol√≠gono de predio
      if (poligonos.length > 0 && iata) {
        const feats = poligonos.filter(f => {
          const props = f.properties || {};
          const code = props.IATA || props.iata || props.iata_code;
          return String(code).toUpperCase() === String(iata).toUpperCase();
        });

        if (feats.length > 0) {
          poligonoLayer = L.geoJSON(feats, {
            style: {
              color: "#0072bb",
              weight: 2,
              fillColor: "#4fa3ff",
              fillOpacity: 0.35
            }
          }).addTo(map);

          const bounds = poligonoLayer.getBounds();
          if (bounds.isValid()) {
            setTimeout(() => {
              map.invalidateSize();
              map.fitBounds(bounds, { padding: [5, 5] });
            }, 0);
          }

          // Si hay pol√≠gono, no mostramos el marker
          if (mapMarker) {
            map.removeLayer(mapMarker);
          }
          return;
        }
      }

      // 2) Fallback: centrar en Lat/Lon de aeropuerto
      let lat = a["Lat"] || a["LAT"];
      let lon = a["Lon"] || a["LON"] || a["Long"];

      if (lat && lon && !isNaN(Number(lat)) && !isNaN(Number(lon))) {
        const latNum = Number(lat);
        const lonNum = Number(lon);

        setTimeout(() => {
          map.invalidateSize();
          map.setView([latNum, lonNum], 11);
        }, 0);

        if (!mapMarker) {
          mapMarker = L.marker([latNum, lonNum]).addTo(map);
        } else {
          mapMarker.setLatLng([latNum, lonNum]).addTo(map);
        }
      } else {
        // Si no hay nada, vista general
        setTimeout(() => {
          map.invalidateSize();
          map.setView([-34.6, -58.4], 5);
        }, 0);
        if (mapMarker) {
          mapMarker.setLatLng([-34.6, -58.4]).addTo(map);
        }
      }
    }

    /* ============================================
       MAPA DE POSICIONES (PSN) + PISTAS SOBRE SAT√âLITE
       ============================================ */
    function updatePSNMapForAirport(a) {
      if (!mapPSN) return;

      // Limpiar capa previa de PSN
      if (psnLayer) {
        mapPSN.removeLayer(psnLayer);
        psnLayer = null;
      }

      // Limpiar capa previa de pistas
      if (pistasLayerPSN) {
        mapPSN.removeLayer(pistasLayerPSN);
        pistasLayerPSN = null;
      }

      const iata = a.IATA;
      if (!iata) return;

      /* ----- 1) Filtrar PSN por IATA ----- */
      let featsPSN = [];
      if (psnFeatures.length) {
        featsPSN = psnFeatures.filter(f => {
          const props = f.properties || {};
          const code = props.IATA || props.iata || props.iata_code;
          return String(code).toUpperCase() === String(iata).toUpperCase();
        });
      }

      if (featsPSN.length) {
        // Crear capa PSN (EPSG:4326, coordenadas lon/lat) con marcadores circulares
        psnLayer = L.geoJSON(featsPSN, {
          pointToLayer: (feature, latlng) => {
            // üî¥ Marcador peque√±o rojo con borde negro
            const marker = L.circleMarker(latlng, {
              radius: 4,
              color: "#000000",     // borde negro
              weight: 1,
              fillColor: "#ff0000", // relleno rojo
              fillOpacity: 0.9
            });

            // Etiqueta con el valor del campo "posicion"
            const posLabel = feature.properties?.posicion || "";
            if (posLabel) {
              marker.bindTooltip(posLabel, {
                permanent: true,
                direction: "top",
                offset: [0, -4],
                className: "psn-tooltip"
              });
            }

            return marker;
          }
        }).addTo(mapPSN);
      }

      /* ----- 2) Filtrar PISTAS por IATA y agregarlas al mismo mapa ----- */
      let featsPistas = [];
      if (pistasFeatures.length) {
        featsPistas = pistasFeatures.filter(f => {
          const props = f.properties || {};
          const code = props.IATA || props.iata || props.iata_code;
          return String(code).toUpperCase() === String(iata).toUpperCase();
        });
      }

      if (featsPistas.length) {
        pistasLayerPSN = L.geoJSON(featsPistas, {
          style: {
            color: "#222",      // gris oscuro
            weight: 1,
            fillColor: "#ffff00",
            fillOpacity: 0.15      // relleno suave
          },
          onEachFeature: (feature, layer) => {
            // Tomamos el campo "etiqueta" (o "ETIQUETA" por las dudas)
            const label =
              (feature.properties && (feature.properties.etiqueta || feature.properties.ETIQUETA)) || "";

            if (label) {
              layer.bindTooltip(label, {
                permanent: true,
                direction: "center",
                className: "psn-tooltip" // misma clase que us√°s para las PSN
              });
            }
          }
        }).addTo(mapPSN);
      }

      /* ----- 3) Ajustar vista (bounds combinados PSN + pistas) ----- */
      let bounds = null;

      if (psnLayer) {
        const b1 = psnLayer.getBounds();
        if (b1.isValid()) bounds = b1;
      }

      if (pistasLayerPSN) {
        const b2 = pistasLayerPSN.getBounds();
        if (b2.isValid()) {
          if (bounds) {
            bounds.extend(b2);
          } else {
            bounds = b2;
          }
        }
      }

      // Si hay al menos PSN o pistas, centramos en sus bounds
      if (bounds && bounds.isValid()) {
        setTimeout(() => {
          mapPSN.invalidateSize();
          mapPSN.fitBounds(bounds, { padding: [5, 5] });
        }, 0);
        return;
      }

      /* ----- 4) Si NO hay PSN ni pistas, centramos en Lat/Lon del aeropuerto ----- */
      let lat = a["Lat"] || a["LAT"];
      let lon = a["Lon"] || a["LON"] || a["Long"];

      if (lat && lon && !isNaN(Number(lat)) && !isNaN(Number(lon))) {
        const latNum = Number(lat);
        const lonNum = Number(lon);

        setTimeout(() => {
          mapPSN.invalidateSize();
          mapPSN.setView([latNum, lonNum], 15);
        }, 0);
      } else {
        // Fallback a vista general de Argentina
        setTimeout(() => {
          mapPSN.invalidateSize();
          mapPSN.setView([-34.6, -58.4], 5);
        }, 0);
      }
    }
/* ============================================
   MAPA DE UBICACI√ìN NACIONAL
   ============================================ */
function updateUbicacionMapForAirport(a) {
  if (!mapUbicacion) return;

  // 1) Agregar provincias (solo una vez)
  if (!provinciasLayer && provinciasFeatures.length) {
    provinciasLayer = L.geoJSON(provinciasFeatures, {
      style: {
        color: "#b0b0b0",
        weight: 1,
        fillColor: "#f5f5f5",
        fillOpacity: 0.6
      }
    }).addTo(mapUbicacion);
  }

  // 2) Limpiar marcador anterior
  if (ubicacionMarker) {
    mapUbicacion.removeLayer(ubicacionMarker);
    ubicacionMarker = null;
  }

  // 3) Obtener centro del aeropuerto (pol√≠gono o lat/lon)
  const center = getAirportCenterLatLng(a);

if (center) {
  const [latNum, lonNum] = center;

  // üîπ Marker con icono personalizado
  ubicacionMarker = L.marker([latNum, lonNum], {
    icon: airportIcon
  }).addTo(mapUbicacion);

  const iataLabel = a["IATA"] ? String(a["IATA"]).toUpperCase() : "";
  if (iataLabel) {
    ubicacionMarker.bindTooltip(iataLabel, {
      permanent: true,
      direction: "top",
      offset: [0, -4],
      className: "psn-tooltip"
    });
  }

  setTimeout(() => {
    mapUbicacion.invalidateSize();
    mapUbicacion.setView([latNum, lonNum], 4);
  }, 0);
  } else {
    // Sin centro conocido: vista general est√°ndar
    setTimeout(() => {
      mapUbicacion.invalidateSize();
      mapUbicacion.setView([-38, -64], 4);
    }, 0);
  }
}


    /* ============================================
       RENDER PRINCIPAL DEL AEROPUERTO
       ============================================ */
    function renderAirport(iataCode) {
      const a = aeropuertos.find(x => x.IATA === iataCode);
      if (!a) return;

      const nombre = clean(a["Aeropuerto"]) || clean(a["Nombre del Aeropuerto"]) || a.IATA;

      const tituloAeroSeccion = `${nombre} (${a.IATA})`;

document.getElementById("hdrSuperficie").innerHTML =
  `Superficie <small>${tituloAeroSeccion}</small>`;

document.getElementById("hdrMovimiento").innerHTML =
  `√Årea de movimiento <small>${tituloAeroSeccion}</small>`;
document.getElementById("hdrTerminal").innerHTML =
  `Terminal de pasajeros <small>${tituloAeroSeccion}</small>`;
document.getElementById("hdrUbicacion").innerHTML =
  `Ubicaci√≥n y accesibilidad <small>${tituloAeroSeccion}</small>`;
document.getElementById("hdrConcesion").innerHTML =
  `Concesi√≥n y explotaci√≥n <small>${tituloAeroSeccion}</small>`;
document.getElementById("hdrEmpleo").innerHTML =
  `Empleo y √°rea de influencia <small>${tituloAeroSeccion}</small>`;
document.getElementById("hdrServicios").innerHTML =
  `Servicios y ayudas <small>${tituloAeroSeccion}</small>`;
      
      document.getElementById("pageTitle").textContent =
        `Aeropuerto de ${nombre} (${a.IATA})`;
      document.getElementById("pageSubtitle").textContent =
        `Sistema Nacional de Aeropuertos ¬∑ Datos Clave ${a["A√±o"] || ""}`;

      /* ----- KPI strip superior ----- */
      document.getElementById("kpiCheckin").textContent =
        safeVal(a["Mostradores Check in"]);
      document.getElementById("kpiPuertas").textContent =
        safeVal(a["PuertasEmbarqueTotal"]);
      document.getElementById("kpiCintas").textContent =
        safeVal(a["CintasTotal"]);
      document.getElementById("kpiPSN").textContent =
        safeVal(a["PSNTotal"]);
      document.getElementById("kpiEstac").textContent =
        safeVal(a["Estacionamiento Vehicular"]);
      document.getElementById("kpiMangas").textContent =
        safeVal(a["Mangas telesc√≥picas"]);
      document.getElementById("kpiPSA").textContent =
        safeVal(a["PSAScanTotal"]);

      /* ----- SUPERFICIE ----- */
      document.getElementById("supPredio").textContent =
        safeVal(a["SupPredioHa"]);
      document.getElementById("terminalM2").textContent =
        safeVal(a["TerminalM2"]);

      // Imagen de terminal (fallback por IATA_terminal.png)
      const imgTerminal = document.getElementById("imgTerminal");
      const iataUpper = String(a.IATA || "").toUpperCase();
      const terminalProp = clean(a["imagenAeropuerto"]);
      const terminalSrc = terminalProp || (iataUpper ? `img/Terminales/${iataUpper}_terminal.png` : "");

      imgTerminal.style.display = terminalSrc ? "block" : "none";
      imgTerminal.src = terminalSrc;
      imgTerminal.alt = `Terminal del aeropuerto ${nombre}`;
      imgTerminal.onerror = () => {
        imgTerminal.style.display = "none";
      };

      /* ----- √ÅREA DE MOVIMIENTO: pistas ----- */
      const orientRaw = clean(a["PistaOrientacion"]);
      const dimsRaw   = clean(a["Dimensiones"]);
      const matRaw    = clean(a["MaterialPista"]);

      const oriArr  = splitField(orientRaw);
      const dimsArr = splitField(dimsRaw);
      const matArr  = splitField(matRaw);

      const runways = oriArr.length
        ? oriArr.map((ori, idx) => ({
            ori,
            dim: dimsArr[idx] || "",
            mat: matArr[idx] || ""
          }))
        : [];

      const cant = runways.length || (orientRaw ? 1 : 0);
      const badgeCantEl     = document.getElementById("badgeCantPistas");
      const pistasSubEl     = document.getElementById("pistasSubtitulo");
      const pistasDetalleEl = document.getElementById("pistasDetalle");

      // Cantidad de pistas + subt√≠tulo din√°mico
      if (cant > 0) {
        if (badgeCantEl) badgeCantEl.textContent = formatNumber(cant);
        if (pistasSubEl) {
          pistasSubEl.textContent = cant === 1
            ? "1 pista registrada"
            : `${formatNumber(cant)} pistas registradas`;
        }
      } else {
        if (badgeCantEl) badgeCantEl.textContent = "‚Äì";
        if (pistasSubEl) pistasSubEl.textContent = "Sin informaci√≥n de pistas";
      }

// Detalle de cada pista
pistasDetalleEl.innerHTML = "";

if (runways.length) {
  runways.forEach(r => {
    const row = document.createElement("div");
    row.className = "mov-runway-row";

    const dimText = r.dim || "";
    const matText = r.mat || "";

    row.innerHTML = `
      <span class="mov-runway-orient">Pista ${r.ori}</span>
      <span class="mov-runway-info">
        ${dimText ? `<span class="runway-chip">${dimText}</span>` : ""}
        ${matText ? `<span class="mov-runway-mat">${matText}</span>` : ""}
      </span>
    `;
    pistasDetalleEl.appendChild(row);
  });
} else if (orientRaw || dimsRaw || matRaw) {
  // Caso simple (solo un registro en campos planos)
  const row = document.createElement("div");
  row.className = "mov-runway-row";

  const dimText = dimsRaw || "";
  const matText = matRaw || "";
  const oriText = orientRaw ? `Pista ${orientRaw}` : "";

  row.innerHTML = `
    <span class="mov-runway-orient">${oriText}</span>
    <span class="mov-runway-info">
      ${dimText ? `<span class="runway-chip">${dimText}</span>` : ""}
      ${matText ? `<span class="mov-runway-mat">${matText}</span>` : ""}
    </span>
  `;
  pistasDetalleEl.appendChild(row);
} else {
  pistasDetalleEl.textContent = "‚Äì";
}


      /* ----- PSN: comerciales / aviaci√≥n general + total ----- */
      // Comerciales = PSNRemotasC + PSNRemotasC_1
      // Aviaci√≥n general = PSN_C

      const rawPsnRemC  = a["PSNRemotasC"];
      const rawPsnRemC1 = a["PSNRemotasC_1"];
      const rawPsnGen   = a["PSN_C"];

      // Suma para Aeronaves comerciales
      const psnComNum = (Number(rawPsnRemC) || 0) + (Number(rawPsnRemC1) || 0);
      const hasPsnCom = rawPsnRemC !== undefined || rawPsnRemC1 !== undefined;

      // Valor para Aviaci√≥n general
      const psnGenNum = Number(rawPsnGen);
      const hasPsnGen = rawPsnGen !== undefined && rawPsnGen !== "";

      // Texto en las ‚Äúburbujas‚Äù de la secci√≥n √Årea de movimiento
      const psnComEl       = document.getElementById("psnCom");
      const psnGenEl       = document.getElementById("psnGen");
      const badgePsnTotalEl = document.getElementById("badgePsnTotal");

      // Aeronaves comerciales
      if (psnComEl) {
        psnComEl.textContent =
          hasPsnCom && !isNaN(psnComNum) ? formatNumber(psnComNum) : "‚Äì";
      }

      // Aviaci√≥n general
      if (psnGenEl) {
        psnGenEl.textContent =
          hasPsnGen && !isNaN(psnGenNum) ? formatNumber(psnGenNum) : "‚Äì";
      }

      // Total de PSN (comerciales + aviaci√≥n general) para la burbuja morada
      let totalPsn = 0;
      if (hasPsnCom && !isNaN(psnComNum)) totalPsn += psnComNum;
      if (hasPsnGen && !isNaN(psnGenNum)) totalPsn += psnGenNum;

      if (badgePsnTotalEl) {
        badgePsnTotalEl.textContent =
          totalPsn ? formatNumber(totalPsn) : "‚Äì";
      }

      /* ----- TERMINAL (recorrido) ----- */
      document.getElementById("terminalM2Dup").textContent =
        safeVal(a["TerminalM2"]);
      document.getElementById("mostradoresCheckin").textContent =
        safeVal(a["Mostradores Check in"]);
      document.getElementById("kioscosSelf").textContent =
        safeVal(a["Kioscos         (self check In)"]);
      document.getElementById("psaBadgeProxy").textContent =
        safeVal(a["PSAScanTotal"]);
      document.getElementById("puertasTotal").textContent =
        safeVal(a["PuertasEmbarqueTotal"]);

      const puertasDetalle = [];
      if (a["PuertasEmbarqueInter"]) puertasDetalle.push(`Internacional: ${a["PuertasEmbarqueInter"]}`);
      if (a["PuertasEmbarqueCabot"]) puertasDetalle.push(`Cabotaje: ${a["PuertasEmbarqueCabot"]}`);
      if (a["PuertasEmbarqueFlex"]) puertasDetalle.push(`Flex: ${a["PuertasEmbarqueFlex"]}`);
      document.getElementById("puertasDetalle").textContent =
        puertasDetalle.length ? puertasDetalle.join(" ¬∑ ") : "‚Äì";

      document.getElementById("mangas").textContent =
        safeVal(a["Mangas telesc√≥picas"]);
      document.getElementById("cintasTotal").textContent =
        safeVal(a["CintasTotal"]);

      const cintasDetalle = [];
      if (a["CintasInter"]) cintasDetalle.push(`Internacional: ${a["CintasInter"]}`);
      if (a["CintasCabot"]) cintasDetalle.push(`Cabotaje: ${a["CintasCabot"]}`);
      if (a["CintasFlex"]) cintasDetalle.push(`Flex: ${a["CintasFlex"]}`);
      document.getElementById("cintasDetalle").textContent =
        cintasDetalle.length ? cintasDetalle.join(" ¬∑ ") : "‚Äì";

      document.getElementById("estacionamiento").textContent =
        safeVal(a["Estacionamiento Vehicular"]);
      document.getElementById("carritos").textContent =
        safeVal(a["Carritos porta equipajes"]);

      /* ----- UBICACI√ìN ----- */
      const loc = `${clean(a["Localidad"])} ¬∑ ${clean(a["Provincia"])}`
        .replace(/^ ¬∑ | ¬∑ $/g, "");
      document.getElementById("ubicacionText").textContent = loc || "‚Äì";

      const dist = a["Distancia al centro de la ciudad (km)"];
      document.getElementById("distanciaCentro").textContent =
        dist ? `${formatNumber(dist)} km` : "‚Äì";

      document.getElementById("horarioOperacion").textContent =
        clean(a["Horario de operaci√≥n"]) || "‚Äì";

      /* ----- CONCESI√ìN Y EXPLOTACI√ìN ----- */
      document.getElementById("supConcesionadaHa").textContent =
        safeVal(a["SupConcesionadaHa"]);
      document.getElementById("areasConcesionadas").textContent =
        clean(a["AreasConcesionadas"]) || "‚Äì";

      document.getElementById("explotador").textContent =
        clean(a["Explotador"]) || "‚Äì";
      document.getElementById("grupo").textContent =
        clean(a["Grupo"]) || "‚Äì";
      document.getElementById("concesionHasta").textContent =
        clean(a["ConcesionHasta"]) || "‚Äì";

      const cods = [];
      if (clean(a["OACI"])) cods.push(`OACI: ${clean(a["OACI"])}`);
      if (clean(a["ANAC"])) cods.push(`ANAC: ${clean(a["ANAC"])}`);
      if (clean(a["IATA"])) cods.push(`IATA: ${clean(a["IATA"])}`);
      document.getElementById("codigos").textContent =
        cods.length ? cods.join(" ¬∑ ") : "‚Äì";

      document.getElementById("habilitacion").textContent =
        clean(a["Habilitaci√≥n"]) || "‚Äì";

      /* ----- EMPLEO Y POBLACI√ìN ----- */
      document.getElementById("empleoDirecto").textContent =
        safeVal(a["EmpleoDirecto2024"]);
      document.getElementById("poblacionInfluencia").textContent =
        safeVal(a["Poblaci√≥n del √Årea de Influencia (Censo 2022)"]);

      /* ----- SERVICIOS Y AYUDAS (panel Servicios) ----- */
      document.getElementById("radioayudas").textContent =
        clean(a["Radioayudas"]) || "‚Äì";
      document.getElementById("ayudasVisuales").textContent =
        clean(a["Ayudas visuales"]) || "‚Äì";
      document.getElementById("awos").textContent =
        clean(a["AWOS"]) || "‚Äì";

      document.getElementById("operadorCargas").textContent =
        clean(a["OperadorCargas"]) || "‚Äì";
      document.getElementById("terminalCargasM2").textContent =
        safeVal(a["TerminalCargasM2"]);

      const aeroComb = [];
      if (a["Aeroplantas AV GAS"]) aeroComb.push(`AV GAS: ${a["Aeroplantas AV GAS"]}`);
      if (a["Aeroplantas JP1"]) aeroComb.push(`JP1: ${a["Aeroplantas JP1"]}`);
      document.getElementById("aeroplantas").textContent =
        aeroComb.length ? aeroComb.join(" ¬∑ ") : "‚Äì";

      document.getElementById("claveRef").textContent =
        clean(a["CLAVE DE REFERENCIA DE AER√ìDROMO"]) || "‚Äì";
      document.getElementById("categoriaSEI").textContent =
        clean(a["CATEGOR√çA SEI NORMAL"]) || "‚Äì";

      /* ----- FOOTER ----- */
      document.getElementById("footerNote").textContent =
        `Fuente: ORSNA ‚Äì Datos b√°sicos por aeropuerto ¬∑ A√±o ${a["A√±o"] || ""}.`;

      /* ----- ACTUALIZAR MAPAS ----- */
      updateMapForAirport(a);
      updatePSNMapForAirport(a);
      updateUbicacionMapForAirport(a);
    }

    /* ============================================
       CARGA DE DATOS (GeoJSON)
       ============================================ */
    async function loadData() {
      try {
        // 1) Datos b√°sicos por aeropuerto
        const resp = await fetch("fuentes/Datos_aeropuertos.geojson");
        const geojson = await resp.json();

        const features = geojson.features || [];
        aeropuertos = features
          .map(f => f.properties || {})
          .filter(p => p.IATA);

        // Ordenar por IATA
        aeropuertos.sort((a, b) => String(a.IATA).localeCompare(String(b.IATA)));

        // Poblar selector
        selectEl.innerHTML = "";
        aeropuertos.forEach(p => {
          const opt = document.createElement("option");
          const nombre = clean(p["Aeropuerto"]) || clean(p["Nombre del Aeropuerto"]) || p.IATA;
          opt.value = p.IATA;
          opt.textContent = `${nombre} (${p.IATA})`;
          selectEl.appendChild(opt);
        });

        // 2) Pol√≠gonos de predios
        try {
          const respPoly = await fetch("fuentes/poligonos_aeropuertos.geojson");
          const gjPoly = await respPoly.json();
          poligonos = gjPoly.features || [];
        } catch (e) {
          console.warn("No se pudieron cargar los pol√≠gonos de aeropuertos:", e);
          poligonos = [];
        }

        // 3) Posiciones de estacionamiento (PSN)
        try {
          const respPSN = await fetch("fuentes/psn_posiciones.geojson");
          const gjPSN = await respPSN.json();
          psnFeatures = gjPSN.features || [];
        } catch (e) {
          console.warn("No se pudieron cargar las posiciones de estacionamiento:", e);
          psnFeatures = [];
        }

        // 4) NUEVO: Pistas (MultiPolygon)
        try {
          const respPistas = await fetch("fuentes/pistas.geojson");
          const gjPistas = await respPistas.json();
          pistasFeatures = gjPistas.features || [];
        } catch (e) {
          console.warn("No se pudieron cargar las pistas:", e);
          pistasFeatures = [];
        }

        // 5) Provincias (para mapa nacional) - opcional
try {
  const respProv = await fetch("fuentes/provincias.geojson");
  const gjProv = await respProv.json();
  provinciasFeatures = gjProv.features || [];
} catch (e) {
  console.warn("No se pudieron cargar las provincias:", e);
  provinciasFeatures = [];
}

        // Selecci√≥n inicial (por URL ?airport=XXX o primer aeropuerto)
        const params = new URLSearchParams(window.location.search);
        const fromUrl = params.get("airport");
        let initial = aeropuertos[0]?.IATA;
        if (fromUrl && aeropuertos.find(a => String(a.IATA) === String(fromUrl))) {
          initial = fromUrl;
        }

        if (initial) {
          selectEl.value = initial;
          renderAirport(initial);
        }

        // Cambio de aeropuerto en el selector
        selectEl.addEventListener("change", e => {
          renderAirport(e.target.value);
          const url = new URL(window.location.href);
          url.searchParams.set("airport", e.target.value);
          window.history.replaceState({}, "", url);
        });
      } catch (err) {
        console.error("Error cargando GeoJSON:", err);
        selectEl.innerHTML = "<option>Error al cargar datos</option>";
      }
    }

    /* ============================================
       INICIO
       ============================================ */
    document.addEventListener("DOMContentLoaded", () => {
      initMap();
      loadData();
    });
  </script>
</body>
</html>
