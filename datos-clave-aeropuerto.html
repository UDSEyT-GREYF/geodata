<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Datos clave de aeropuertos – ORSNA GeoData</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Librería para leer Excel en el navegador -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    /* ENCABEZADO */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 16px;
    }

    .title {
      font-size: 1.6rem;
      font-weight: 700;
      color: #2a5fa0;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #555;
      margin-top: 4px;
    }

    .selector {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 0.9rem;
    }

    .selector label { color: #444; }

    .selector select {
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid #c0c7d4;
      font-size: 0.9rem;
    }

    /* GRID PRINCIPAL */
    .grid {
      display: grid;
      grid-template-columns: 2fr 2fr 2fr;
      gap: 10px;
      margin-top: 8px;
    }

    .panel {
      background: #fff;
      border-radius: 4px;
      border: 1px solid #d0d7e2;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      background: #306fb0;
      color: #fff;
      padding: 6px 10px;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .panel-body {
      padding: 8px 10px;
      font-size: 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .two-rows {
      display: grid;
      grid-template-rows: 1fr 1fr;
      gap: 8px;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
      font-size: 0.9rem;
    }

    .metric-row span.value {
      font-size: 1.4rem;
      font-weight: 700;
      color: #2a5fa0;
    }

    .small-label {
      font-size: 0.8rem;
      color: #777;
    }

    ul {
      padding-left: 18px;
      font-size: 0.88rem;
    }

    .big-number {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      background: #2a8ad4;
      display: inline-block;
      padding: 8px 18px;
      border-radius: 999px;
      margin: 6px 0;
    }

    .subpanel-title {
      margin-top: 6px;
      font-weight: 600;
      color: #2a5fa0;
      font-size: 0.9rem;
    }

    .inline-metrics {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      font-size: 0.85rem;
    }

    .inline-metrics div span.value {
      font-weight: 600;
    }

    .pill {
      display: inline-block;
      background: #2a5fa0;
      color: #fff;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.8rem;
      margin-right: 4px;
    }

    .airlines-list, .destinations-list {
      font-size: 0.88rem;
      margin-top: 4px;
    }

    .chart-container {
      margin-top: 8px;
      text-align: center;
    }

    .chart-container img {
      max-width: 100%;
      max-height: 260px;
      object-fit: contain;
    }

    footer {
      margin-top: 12px;
      text-align: right;
      font-size: 0.8rem;
      color: #777;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
      header { flex-direction: column; align-items: flex-start; }
      .selector { align-items: flex-start; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <div>
        <div class="title" id="titleText">
          Datos clave del aeropuerto
        </div>
        <div class="subtitle" id="subtitleText">
          Sistema Nacional de Aeropuertos · ORSNA
        </div>
      </div>

      <div class="selector">
        <label for="airportSelect">Seleccionar aeropuerto</label>
        <select id="airportSelect">
          <option value="">Cargando...</option>
        </select>
      </div>
    </header>

    <div class="grid">

      <!-- SUPERFICIE / ÁREA MOVIMIENTO -->
      <section class="panel">
        <div class="panel-header">Superficie y área de movimiento</div>
        <div class="panel-body two-rows">

          <div>
            <div class="metric-row">
              <span>Tamaño del predio</span>
              <span class="value" id="surfaceHa">–</span>
            </div>
            <div class="small-label">hectáreas</div>

            <div class="metric-row" style="margin-top:6px;">
              <span>Superficie concesionada</span>
              <span class="value" id="concessionHa">–</span>
            </div>
            <div class="small-label">hectáreas</div>

            <div class="small-label" style="margin-top:6px;">Áreas concesionadas</div>
            <div class="small-label" id="areasConcesionadas">–</div>
          </div>

          <div>
            <div class="subpanel-title">Área de movimiento</div>
            <div class="metric-row" style="margin-top:4px;">
              <span>Pistas</span>
              <span class="value" id="runwaysCount">–</span>
            </div>
            <div class="small-label" id="runwaysIds">–</div>

            <div class="small-label" style="margin-top:6px;">Dimensiones (m x ancho)</div>
            <ul id="runwaysLengths">
              <!-- JS -->
            </ul>

            <div class="metric-row" style="margin-top:6px;">
              <span>Posiciones totales en plataforma</span>
              <span class="value" id="standsTotal">–</span>
            </div>
          </div>

        </div>
      </section>

      <!-- TERMINAL DE PASAJEROS -->
      <section class="panel">
        <div class="panel-header">Terminal de pasajeros</div>
        <div class="panel-body">
          <div class="metric-row">
            <span>Superficie de terminal</span>
            <span class="value" id="terminalArea">–</span>
          </div>
          <div class="small-label">m²</div>

          <div class="metric-row" style="margin-top:6px;">
            <span>Mostradores de check-in</span>
            <span class="value" id="checkinCounters">–</span>
          </div>
          <div class="metric-row">
            <span>Puertas de embarque</span>
            <span class="value" id="boardingGates">–</span>
          </div>
          <div class="metric-row">
            <span>Cintas de equipaje</span>
            <span class="value" id="baggageBelts">–</span>
          </div>
          <div class="metric-row">
            <span>Mangas telescópicas</span>
            <span class="value" id="jetbridges">–</span>
          </div>
          <div class="metric-row">
            <span>Plazas de estacionamiento vehicular</span>
            <span class="value" id="parkingSpots">–</span>
          </div>
        </div>
      </section>

      <!-- INFORMACIÓN GENERAL / GRÁFICO -->
      <section class="panel">
        <div class="panel-header">Información general</div>
        <div class="panel-body">
          <div class="small-label">Operador</div>
          <div class="small-label" id="operatorText">–</div>

          <div class="small-label" style="margin-top:6px;">Concesión hasta</div>
          <div class="small-label" id="concessionUntilText">–</div>

          <div class="small-label" style="margin-top:6px;">Provincia / Localidad</div>
          <div class="small-label" id="locationText">–</div>

          <div class="small-label" style="margin-top:6px;">Códigos OACI / ANAC</div>
          <div class="small-label" id="codesText">–</div>

          <div class="chart-container" style="margin-top:10px;">
            <div class="small-label">Gráfico / imagen asociada</div>
            <img id="chartImage" src="" alt="Gráfico del aeropuerto">
          </div>
        </div>
      </section>

    </div>

    <footer id="footerNote">
      Fuente: ORSNA – Datos desde planilla TodoHTML.
    </footer>
  </div>

  <script>
    let airports = [];
    const selectEl = document.getElementById("airportSelect");

    function formatNumber(n) {
      if (n === null || n === undefined || n === "" || isNaN(n)) return "–";
      return Number(n).toLocaleString("es-AR");
    }

    function renderAirport(code) {
      const a = airports.find(x => x.code === code);
      if (!a) return;

      // Título y subtítulo
      document.getElementById("titleText").textContent =
        `Aeropuerto de ${a.airportShort} (${a.code}) – Datos clave del aeropuerto`;

      document.getElementById("subtitleText").textContent =
        `Sistema Nacional de Aeropuertos · ORSNA · Datos ${a.year || ""}`;

      // Superficie
      document.getElementById("surfaceHa").textContent = formatNumber(a.surfaceHa);
      document.getElementById("concessionHa").textContent = formatNumber(a.concessionHa);
      document.getElementById("areasConcesionadas").textContent = a.areasConcesionadas || "–";

      // Pistas
      const ids = (a.runwaysIds || "").replace(/\s+/g, " ").trim();
      document.getElementById("runwaysIds").textContent = ids || "–";

      const lengthsUl = document.getElementById("runwaysLengths");
      lengthsUl.innerHTML = "";
      (a.runwaysLengths || []).forEach(txt => {
        const li = document.createElement("li");
        li.textContent = txt;
        lengthsUl.appendChild(li);
      });

      document.getElementById("runwaysCount").textContent =
        (a.runwaysLengths && a.runwaysLengths.length) ? a.runwaysLengths.length : "–";

      document.getElementById("standsTotal").textContent = formatNumber(a.standsTotal);

      // Terminal
      document.getElementById("terminalArea").textContent = formatNumber(a.terminalM2);
      document.getElementById("checkinCounters").textContent = formatNumber(a.checkinCounters);
      document.getElementById("boardingGates").textContent = formatNumber(a.gatesTotal);
      document.getElementById("baggageBelts").textContent = formatNumber(a.baggageBelts);
      document.getElementById("jetbridges").textContent = formatNumber(a.jetbridges);
      document.getElementById("parkingSpots").textContent = formatNumber(a.parkingSpots);

      // Info general
      document.getElementById("operatorText").textContent = a.operator || "–";
      document.getElementById("concessionUntilText").textContent = a.concessionUntil || "–";
      document.getElementById("locationText").textContent =
        `${a.city || ""} · ${a.province || ""}`.replace(/^ · | · $/g, "") || "–";
      document.getElementById("codesText").textContent =
        `${a.oaci || ""} / ${a.anac || ""}`.replace(/^ \/ | \/ $/g, "") || "–";

      // Imagen asociada
      const img = document.getElementById("chartImage");
      img.src = a.imgFicha;
      img.alt = `Gráfico / imagen del aeropuerto ${a.airportShort} (${a.code})`;

      document.getElementById("footerNote").textContent =
        `Fuente: ORSNA – Planilla TodoHTML, año ${a.year || ""}.`;
    }

    async function loadData() {
      try {
        const resp = await fetch("fuentes/Planilla de datos básica x aeropuerto al 08-08-25_paraHTML.xlsx");
        const arrayBuffer = await resp.arrayBuffer();

        const workbook = XLSX.read(arrayBuffer, { type: "array" });
        const sheet = workbook.Sheets["TodoHTML"];
        const rows = XLSX.utils.sheet_to_json(sheet, { defval: null });

        airports = rows
          .filter(r => r.IATA)
          .map(r => {
            const iata = String(r.IATA).trim();
            const dims = (r.Dimensiones || "").toString();
            const runways = dims
              .split(";")
              .map(s => s.trim())
              .filter(Boolean);

            return {
              code: iata,
              airportShort: (r.Aeropuerto || "").toString().trim(),
              airportName: (r["Nombre del Aeropuerto"] || "").toString().trim(),
              city: (r.Localidad || "").toString().trim(),
              province: (r.Provincia || "").toString().trim(),
              year: r["Año"],
              group: (r.Grupo || "").toString().trim(),
              operator: (r.Explotador || "").toString().trim(),
              concessionUntil: (r.ConcesionHasta || "").toString().trim(),
              surfaceHa: r.SupPredioHa,
              concessionHa: r.SupConcesionadaHa,
              areasConcesionadas: (r.AreasConcesionadas || "").toString().trim(),
              terminalM2: r.TerminalM2,
              checkinCounters: r["Mostradores Check in"],
              gatesTotal: r.PuertasEmbarqueTotal,
              jetbridges: r["Mangas telescópicas"],
              baggageBelts: r.CintasTotal,
              parkingSpots: r["Estacionamiento Vehicular"],
              runwaysIds: (r.PistaOrientacion || "").toString(),
              runwaysLengths: runways,
              standsTotal: r.PSNTotal,
              oaci: (r.OACI || "").toString().trim(),
              anac: (r.ANAC || "").toString().trim(),
              imgFicha: `img/datos_clave/${iata}.png`
            };
          });

        // ordenar por código IATA
        airports.sort((a, b) => a.code.localeCompare(b.code));

        // llenar selector
        selectEl.innerHTML = "";
        airports.forEach(a => {
          const opt = document.createElement("option");
          opt.value = a.code;
          opt.textContent = `${a.airportShort || a.airportName} (${a.code})`;
          selectEl.appendChild(opt);
        });

        if (airports.length > 0) {
          selectEl.value = airports[0].code;
          renderAirport(airports[0].code);
        }

        selectEl.addEventListener("change", e => renderAirport(e.target.value));
      } catch (err) {
        console.error("Error cargando datos:", err);
        selectEl.innerHTML = "<option>Error al cargar datos</option>";
      }
    }

    loadData();
  </script>
</body>
</html>

